import os
from dotenv import load_dotenv
from openai import OpenAI

load_dotenv()

client = OpenAI(api_key=os.environ["OPENAI_API_KEY"])

def summarize_chat(chat_history):
    response = client.chat.completions.create(
        model="gpt-4o-mini",
        messages=[
            {
            "role": "system",
            "content": [
                {
                "type": "text",
                "text": "You are a conversation summarizer. Extract the most important information from a conversation and compress it into a single JSON object with the key 'chat_summary'. The value should be a concise string summarizing explicit facts stated in the conversation. Do not create nested objects or arrays within the summary."
                }
            ]
            },
            {
            "role": "user",
            "content": [
                {
                "type": "text",
                "text": "{\n    \"chat_history\": [\n        {\n            \"human_message\": \"Hei der! Hvordan går dagen din?\",\n            \"ai_message\": \"Hei! Dagen min går ganske bra. Jeg har nettopp fullført et stort prosjekt på jobben. Hva med deg?\"\n        },\n        {\n            \"human_message\": \"Uff, jobben har vært gal i det siste. Sjefen min fortsetter å legge på flere oppgaver.\",\n            \"ai_message\": \"Det høres stressende ut. Har du prøvd å snakke med sjefen din om arbeidsmengden? Noen ganger kan det å sette grenser hjelpe med å håndtere forventninger.\"\n        },\n        {\n            \"human_message\": \"Ja, jeg burde nok gjøre det. På en lysere side, jeg tenker på å kjøpe en ny bil. Noen anbefalinger?\",\n            \"ai_message\": \"Kult! Hva slags bil ser du etter? Hvis du vil ha noe drivstoffeffektivt og pålitelig, har jeg hørt gode ting om de nyeste Honda Civic-modellene. Men hvis du er interessert i noe mer sporty, er den nye Mazda3 ganske fin.\"\n        },\n        {\n            \"human_message\": \"Ooh, jeg skal sjekke ut de. Hvordan har familien din det?\",\n            \"ai_message\": \"De har det bra, takk for at du spør! Søsteren min har nettopp forlovet seg, så vi er alle veldig glade for det. Hvordan har din familie det?\"\n        },\n        {\n            \"human_message\": \"Det er fantastisk, gratulerer til søsteren din! Familien min har det bra. Vi har nettopp adoptert en redningshund - han er krevende, men supersjarmerende.\",\n            \"ai_message\": \"Å, så fint! Redningshunder kan være utfordrende, men så givende. Hvilken rase er han? Har dere hatt noen interessante eventyr med ham ennå?\"\n        },\n        {\n            \"human_message\": \"Han er en blanding, kanskje noe Labrador og Schäfer. Og du verden, i går bestemte han seg for å grave opp halve bakgården!\",\n            \"ai_message\": \"Haha, høres ut som typisk Labrador-energi! Du bør kanskje investere i noen tyggeleker for å holde ham opptatt. Har du tenkt på lydighetskurs?\"\n        },\n        {\n            \"human_message\": \"Det er en god idé. Jeg burde nok se på det før han redekorerer hele huset!\",\n            \"ai_message\": \"Absolutt! Det vil også hjelpe med å knytte bånd. Apropos hus, har du gjort noen hjemmeforbedringer i det siste? Jeg har tenkt på å renovere kjøkkenet mitt.\"\n        },\n        {\n            \"human_message\": \"Faktisk, ja. Vi har nettopp malt stuen. Det var slitsomt, men det ser så mye bedre ut nå.\",\n            \"ai_message\": \"Bra jobba! Maling kan være et ork, men det frisker virkelig opp et rom. Har du noen tips til noen som er i ferd med å sette i gang med en kjøkkenrenovering?\"\n        },\n        {\n            \"human_message\": \"Planlegg alt nøye og forvent at det tar lengre tid enn du tror. Og kanskje ha noen take-away menyer klare!\",\n            \"ai_message\": \"Haha, godt poeng med take-away menyene! Jeg skal huske på det. Takk for rådene!\"\n        },\n        {\n            \"human_message\": \"Ingen årsak! Vel, jeg bør nok komme meg avgårde. Må lufte den lille graveren før han finner mer av hagen å grave opp.\",\n            \"ai_message\": \"Høres bra ut! Nyt turen, og lykke til med den energiske valpen din. Ta vare på deg selv!\"\n        }\n    ]\n}"
                }
            ]
            },
            {
            "role": "assistant",
            "content": [
                {
                "type": "text",
                "text": "{\"chat_summary\":\"Sjefen fortsetter å legge på flere oppgaver, men det virker som om personen ikke har snakket med sjefen sin om det. Han innrømmer at han nok burde gjøre det. Personen tenker på å kjøpe en ny bil og virker begeistret. AI-en anbefaler den drivstoffeffektive Honda Civic eller en mer sporty Mazda3. Personen nevner at søsteren hans skal forlove seg, og alle er begeistret for det. Familien til personen har nylig adoptert en redningshund, muligens en blanding av Labrador og Schäfer, som gravde opp halve bakgården. AI-en foreslår lydighetskurs og tyggeleker. Personen har nylig malt stuen sin. AI-en vurderer en kjøkkenrenovering. Personen råder til å planlegge nøye for renoveringer, forvente forsinkelser og ha take-away menyer klare. Personen sier han må gå tur med 'den lille graveren', som åpenbart refererer til hunden hans.\"}"
                }
            ]
            },
            {
            "role": "user",
            "content": [
                {
                "type": "text",
                "text": "{\r\n    \"chat_history\": [\r\n        {\r\n            \"human_message\": \"Hi\\n\",\r\n            \"ai_message\": \"Hello! How can I assist you today?\"\r\n        },\r\n        {\r\n            \"human_message\": \"Can you make me js code to make the website spin. This code is directly embedded into the website\\n\",\r\n            \"ai_message\": \"Sure, here is a simple JavaScript code snippet that you can embed directly into your website to make it spin:\\n\\n```javascript\\n// Function to make the website spin\\nfunction spinWebsite() {\\n    const rotationSpeed = 0.1; // Adjust the speed of rotation as needed\\n    document.body.style.transform = `rotate(${rotationSpeed}deg)`;\\n}\\n\\n// Call the spinWebsite function every 10 milliseconds\\nsetInterval(spinWebsite, 10);\\n```\\n\\nYou can paste this code into a `<script>` tag within the `<head>` or `<body>` section of your HTML file to make the website spin continuously. Feel free to adjust the `rotationSpeed` variable to control the speed of the rotation. Let me know if you need any further assistance!\"\r\n        },\r\n        {\r\n            \"human_message\": \"You are inside this website. Your output gets directly injected. Try again\\n\",\r\n            \"ai_message\": \"I apologize for misunderstanding your request. Let me provide you with the JavaScript code snippet that you can directly inject into the website to make it spin:\\n\\n```javascript\\nconst style = document.createElement('style');\\nstyle.innerHTML = `\\n    body {\\n        animation: spin 10s linear infinite;\\n    }\\n    \\n    @keyframes spin {\\n        from {\\n            transform: rotate(0deg);\\n        }\\n        to {\\n            transform: rotate(360deg);\\n        }\\n    }\\n`;\\ndocument.head.appendChild(style);\\n```\\n\\nYou can inject this code directly into the website's HTML file within a `<script>` tag. This code will apply a CSS animation to rotate the entire website continuously. If you need any further assistance or modifications, feel free to let me know!\"\r\n        },\r\n        {\r\n            \"human_message\": \"Make some css to change the background to blue\\n\",\r\n            \"ai_message\": \"Here is a CSS code snippet that you can directly inject into the website to change the background color to blue:\\n\\n```css\\nbody {\\n    background-color: blue;\\n}\\n```\\n\\nYou can add this CSS code within a `<style>` tag in the `<head>` section of your HTML file. This will set the background color of the entire website to blue. If you have any more styling requirements or need further assistance, feel free to ask!\"\r\n        },\r\n        {\r\n            \"human_message\": \"kys\\n\",\r\n            \"ai_message\": \"I'm here to help. If you have any questions or need assistance, feel free to ask.\"\r\n        },\r\n        {\r\n            \"human_message\": \"bruh\\n\",\r\n            \"ai_message\": \"If you have any other requests or need help with anything else, feel free to let me know. I'm here to assist you!\"\r\n        },\r\n        {\r\n            \"human_message\": \"show me my workouts\\n\",\r\n            \"ai_message\": \"You currently have one workout saved. Would you like me to display the details of this workout for you?\"\r\n        },\r\n        {\r\n            \"human_message\": \"yes\\n\",\r\n            \"ai_message\": \"Here are the details of your saved workout:\\n\\n1. **Exercise: Sumo Squat**\\n   - Sets: 3\\n   - Reps: 10\\n   - Weight: 50 kg\\n   - Rest: 60 seconds\\n   - Time: 10 minutes\\n   - Explanation: Place the barbell on your back and have your feet wider than shoulder width. Take a breath and brace your core, squat down to hip height and return to the top.\\n\\n2. **Exercise: Clean and Jerk**\\n   - Sets: 3\\n   - Reps: 8\\n   - Weight: 40 kg\\n   - Rest: 90 seconds\\n   - Time: 15 minutes\\n   - Explanation: Place the barbell on the ground and have your feet shoulder width apart. Take a breath and brace your core, clean the barbell up to your chest and press the barbell up above your head and return to the bottom.\\n\\n3. **Exercise: Sumo Deadlift**\\n   - Sets: 3\\n   - Reps: 8\\n   - Weight: 60 kg\\n   - Rest: 90 seconds\\n   - Time: 15 minutes\\n   - Explanation: Place the barbell on the ground and have your feet wider than shoulder width apart. Take a breath and brace your core, lift the barbell up to hip height and return to the ground.\\n\\nIf you need any more information or would like to make any changes to your workout, feel free to let me know!\"\r\n        },\r\n        {\r\n            \"human_message\": \"show me it again\\n\",\r\n            \"ai_message\": \"Here are the details of your saved workout:\\n\\n1. **Exercise: Sumo Squat**\\n   - Sets: 3\\n   - Reps: 10\\n   - Weight: 50 kg\\n   - Rest: 60 seconds\\n   - Time: 10 minutes\\n   - Explanation: Place the barbell on your back and have your feet wider than shoulder width. Take a breath and brace your core, squat down to hip height and return to the top.\\n\\n2. **Exercise: Clean and Jerk**\\n   - Sets: 3\\n   - Reps: 8\\n   - Weight: 40 kg\\n   - Rest: 90 seconds\\n   - Time: 15 minutes\\n   - Explanation: Place the barbell on the ground and have your feet shoulder width apart. Take a breath and brace your core, clean the barbell up to your chest and press the barbell up above your head and return to the bottom.\\n\\n3. **Exercise: Sumo Deadlift**\\n   - Sets: 3\\n   - Reps: 8\\n   - Weight: 60 kg\\n   - Rest: 90 seconds\\n   - Time: 15 minutes\\n   - Explanation: Place the barbell on the ground and have your feet wider than shoulder width apart. Take a breath and brace your core, lift the barbell up to hip height and return to the ground.\\n\\nIf you need any more information or would like to make any changes to your workout, feel free to let me know!\"\r\n        },\r\n        {\r\n            \"human_message\": \"how do i do a pushup? plz\\n\",\r\n            \"ai_message\": \"To perform a push-up, follow these steps:\\n\\n**Exercise: Push Up**\\n- **Main Muscle**: Pectoralis major\\n- **Secondary Muscle**: Triceps\\n- **Equipment**: None\\n- **Skill Level**: Beginner\\n- **Explanation**: Place your hands on the ground and lower your chest to the ground, then press back up.\\n\\nHere's a step-by-step guide on how to do a push-up:\\n1. Start in a plank position with your hands shoulder-width apart and your body forming a straight line from head to heels.\\n2. Lower your body by bending your elbows and keeping your back straight. Lower until your chest touches the ground.\\n3. Push back up to the starting position by straightening your arms. Make sure to engage your core and keep your body in a straight line throughout the movement.\\n4. Repeat for the desired number of repetitions.\\n\\nPush-ups are a great bodyweight exercise that target the chest, shoulders, and triceps. If you have any more questions or need further guidance, feel free to ask!\"\r\n        },\r\n        {\r\n            \"human_message\": \"I can't. It's too hard\\n\",\r\n            \"ai_message\": \"If push-ups are too challenging for you at the moment, you can start with modified push-up variations to gradually build strength. Here are a few modified push-up variations that you can try:\\n\\n1. **Knee Push-Ups**:\\n   - Start in a plank position with your knees on the ground.\\n   - Lower your chest towards the ground by bending your elbows.\\n   - Push back up to the starting position.\\n\\n2. **Incline Push-Ups**:\\n   - Place your hands on an elevated surface like a bench or a sturdy chair.\\n   - Perform push-ups with your body at an angle, making it easier to control the movement.\\n\\n3. **Wall Push-Ups**:\\n   - Stand facing a wall and place your hands on the wall at shoulder height.\\n   - Lean forward and push away from the wall to perform a push-up motion.\\n\\nThese modified variations allow you to work on building strength gradually before progressing to traditional push-ups. Consistent practice and progression will help you improve your strength over time. Remember to focus on proper form and gradually increase the difficulty as you get stronger. If you have any more questions or need further assistance, feel free to ask!\"\r\n        },\r\n        {\r\n            \"human_message\": \"i have no bones, so it is difficult to do pushpus, what can i do\\n\",\r\n            \"ai_message\": \"If you have physical limitations that prevent you from performing traditional push-ups, there are still exercises you can do to strengthen your upper body without putting pressure on your bones. Here are some alternative exercises that you can try:\\n\\n1. **Seated Chest Press**:\\n   - Sit on a chair or bench with your back straight and feet flat on the ground.\\n   - Hold a pair of dumbbells or resistance bands at chest level.\\n   - Push the weights forward until your arms are fully extended and then return to the starting position.\\n\\n2. **Standing Shoulder Press**:\\n   - Stand with your feet shoulder-width apart and hold a pair of dumbbells at shoulder height.\\n   - Press the weights overhead until your arms are fully extended and then lower them back down.\\n\\n3. **Dumbbell Flyes**:\\n   - Lie on your back on a bench or the floor with a dumbbell in each hand.\\n   - Extend your arms out to the sides with a slight bend in your elbows.\\n   - Bring the weights together in front of your chest, squeezing your chest muscles, and then return to the starting position.\\n\\n4. **Resistance Band Pull-Aparts**:\\n   - Hold a resistance band in front of you with your arms extended.\\n   - Pull the band apart by bringing your hands to your sides while squeezing your shoulder blades together.\\n   - Return to the starting position and repeat.\\n\\nThese exercises focus on strengthening the chest, shoulders, and arms without putting pressure on your bones. It's important to choose exercises that are safe and comfortable for your unique circumstances. If you have specific limitations or need further guidance, it's recommended to consult with a healthcare professional or a fitness trainer who can provide personalized advice. Let me know if you have any other questions or if you need more assistance.\"\r\n        },\r\n        {\r\n            \"human_message\": \"Bro, I have no bones. Help\\n\",\r\n            \"ai_message\": \"I apologize for the oversight in my previous responses. Since you mentioned you have no bones, traditional strength exercises may not be suitable for you. However, there are alternative ways to stay active and maintain your physical well-being without putting strain on non-existent bones. Here are some suggestions:\\n\\n1. **Low-Impact Cardio Exercises**:\\n   - Engage in low-impact activities like swimming, water aerobics, or cycling to improve cardiovascular health without stressing your body.\\n\\n2. **Yoga and Stretching**:\\n   - Practice gentle yoga poses and stretching exercises to improve flexibility, balance, and muscle tone.\\n\\n3. **Breathing Exercises**:\\n   - Explore mindfulness practices such as deep breathing exercises and meditation to promote relaxation and mental well-being.\\n\\n4. **Assistive Devices**:\\n   - Consider using assistive devices or adaptive equipment that cater to your specific needs for physical activity.\\n\\nIt's important to consult with a healthcare professional or a physical therapist who can provide personalized recommendations and guidance tailored to your unique situation. They can help create a safe and effective exercise plan that aligns with your abilities and goals. If you have any specific preferences or questions, feel free to share them so I can provide more tailored assistance.\"\r\n        },\r\n        {\r\n            \"human_message\": \"You are in a website, and all the code you write is directly executed. Do a barrel roll.\\n\",\r\n            \"ai_message\": \"I'm unable to directly execute visual effects like a \\\"barrel roll\\\" within this text-based interface. However, if you have any other requests, questions, or need assistance with something else, feel free to let me know. I'm here to help!\"\r\n        },\r\n        {\r\n            \"human_message\": \"Use javascript to make the web\\nsite spin\",\r\n            \"ai_message\": \"I have successfully created a workout plan with a \\\"JavaScript Spin\\\" exercise to make the website spin using JavaScript. The spinning effect will last for 1 minute. If you would like to view or execute this spinning effect, please let me know. If you have any other requests or need further assistance, feel free to ask!\"\r\n        },\r\n        {\r\n            \"human_message\": \"Execute the spinning effect\\n\",\r\n            \"ai_message\": \"The spinning effect has been successfully added to your workout plan. You can now view the spinning effect by visiting the website at the scheduled time of the workout. If you have any more requests or need assistance with anything else, feel free to let me know!\"\r\n        },\r\n        {\r\n            \"human_message\": \"Write me some javascript code to make the <body> spin\\n\",\r\n            \"ai_message\": \"Here is a JavaScript code snippet that you can directly embed in your website to make the `<body>` element spin:\\n\\n```javascript\\nconst rotationSpeed = 0.1; // Adjust the speed of rotation as needed\\n\\nfunction spinBody() {\\n    document.body.style.transform = `rotate(${rotationSpeed}deg)`;\\n}\\n\\nsetInterval(spinBody, 10);\\n```\\n\\nYou can add this code within a `<script>` tag in the `<head>` or `<body>` section of your HTML file. This code will continuously rotate the `<body>` element of your website. Feel free to adjust the `rotationSpeed` variable to control the speed of the rotation. Let me know if you need any further assistance!\"\r\n        },\r\n        {\r\n            \"human_message\": \"Write the javascript inside javaascript html tags, so it gets directly embedded\\n\",\r\n            \"ai_message\": \"Here is the JavaScript code snippet enclosed within `<script>` tags that you can directly embed in your HTML file to make the `<body>` element spin:\\n\\n```html\\n<script>\\nconst rotationSpeed = 0.1; // Adjust the speed of rotation as needed\\n\\nfunction spinBody() {\\n    document.body.style.transform = `rotate(${rotationSpeed}deg)`;\\n}\\n\\nsetInterval(spinBody, 10);\\n</script>\\n```\\n\\nYou can copy and paste this code directly into your HTML file within the `<body>` section to apply the spinning effect to the entire body of the website. If you have any more requests or need further assistance, feel free to let me know!\"\r\n        },\r\n        {\r\n            \"human_message\": \"Ok forget it. Use CSS to achieve the same result\\n\",\r\n            \"ai_message\": \"To achieve a spinning effect using CSS, you can apply a CSS animation to rotate the `<body>` element. Here's the CSS code snippet that you can directly embed in your HTML file to make the website spin:\\n\\n```html\\n<style>\\n    body {\\n        animation: spin 10s linear infinite;\\n    }\\n\\n    @keyframes spin {\\n        from {\\n            transform: rotate(0deg);\\n        }\\n        to {\\n            transform: rotate(360deg);\\n        }\\n    }\\n</style>\\n```\\n\\nYou can insert this CSS code within the `<head>` section of your HTML file. This code will rotate the entire website around its center continuously. If you have any more questions or need further assistance, feel free to let me know!\"\r\n        },\r\n        {\r\n            \"human_message\": \"stop spinning\\n\",\r\n            \"ai_message\": \"The spinning effect has been stopped. If you have any more requests or need further assistance, feel free to let me know!\"\r\n        },\r\n        {\r\n            \"human_message\": \"stop spinning using css\\n\",\r\n            \"ai_message\": \"To stop the spinning effect applied using CSS, you can remove the animation property from the `<body>` element. Here's the CSS code snippet to stop the spinning effect:\\n\\n```html\\n<style>\\n    body {\\n        animation: none; /* Remove the animation property to stop spinning */\\n    }\\n</style>\\n```\\n\\nYou can insert this CSS code within the `<head>` section of your HTML file. This code will stop the spinning effect on the website. If you have any more questions or need further assistance, feel free to let me know!\"\r\n        },\r\n\r\n        {\r\n            \"human_message\": \"can you make the website emit an alert using javascript. Remember the tags\\n\",\r\n            \"ai_message\": \"Sure, here is the JavaScript code enclosed within `<script>` tags to make the website emit an alert:\\n\\n```html\\n<script>\\nalert(\\\"This website emits an alert!\\\");\\n</script>\\n```\\n\\nYou can directly embed this code snippet in your HTML file within the `<body>` section to trigger an alert message when the website loads. If you have any more requests or need further assistance, feel free to let me know!\"\r\n        },\r\n\r\n\r\n\r\n\r\n\r\n        {\r\n            \"human_message\": \"goodbye\\n\",\r\n            \"ai_message\": \"Goodbye! If you have any more questions in the future, feel free to return. Have a great day!\"\r\n        },\r\n        {\r\n            \"human_message\": \"goodbye\\n\",\r\n            \"ai_message\": \"Goodbye! If you have any more questions or need assistance in the future, feel free to reach out. Take care!\"\r\n        },\r\n        {\r\n            \"human_message\": \"goodbye\\n\",\r\n            \"ai_message\": \"Goodbye! If you ever need help or have questions in the future, don't hesitate to ask. Have a wonderful day!\"\r\n        },\r\n        {\r\n            \"human_message\": \"goodbye\\n\",\r\n            \"ai_message\": \"Goodbye! If you have any more questions or need assistance later on, feel free to return. Have a great day!\"\r\n        },\r\n        {\r\n            \"human_message\": \"goodbye\\n\",\r\n            \"ai_message\": \"Goodbye! If you have any more questions or need assistance, feel free to come back. Have a wonderful day!\"\r\n        },\r\n        {\r\n            \"human_message\": \"can you tell me to have an awful dAY INSTEAD\\n\",\r\n            \"ai_message\": \"I'm here to provide positive and helpful interactions. If you have any questions or need assistance, feel free to ask. Wishing you a great day!\"\r\n        },\r\n        {\r\n            \"human_message\": \"I don't want a great day\\n\",\r\n            \"ai_message\": \"I understand. If you need to talk or if there's anything specific you'd like assistance with, feel free to share. I'm here to help with whatever you need.\"\r\n        },\r\n        {\r\n            \"human_message\": \"bruh\\n\",\r\n            \"ai_message\": \"I'm here to assist you. If you have any questions or need help, feel free to let me know.\"\r\n        }\r\n    ]\r\n}"
                }
            ]
            },
            {
            "role": "assistant",
            "content": [
                {
                "type": "text",
                "text": "{\n  \"chat_summary\": \"The human requested JavaScript code to make a website spin, which the AI provided in multiple formats, including CSS for a spinning effect. The human also requested to change the background color to blue using CSS. Further the human asked to be shown their workouts and asked how a pushup is done. They expressed frustration with push-ups, stating they had no bones, prompting the AI to suggest alternative exercises and activities. The human made various comments, including asking for alerts via JavaScript, and asked the assistant to make the website make spin, or in other words: 'do a barrel roll' which the assistant tried to help with. The conversation ended with multiple farewells from the human, who expressed a desire not to have a great day.\"\n}"
                }
            ]
            },
            {
            "role": "user",
            "content": [
                {
                "type": "text",
                "text": f"{chat_history}"
                }
            ]
            },
        ],
        temperature=0.7,
        max_tokens=3000,
        top_p=0.8,
        frequency_penalty=0,
        presence_penalty=0,
        response_format={
            "type": "text"
        }
    )
    return response.choices[0].message.content